
alphabet = \
[ [ [False, True,  True,  True,  False],  # { A }
     [True,  False, False, False, True],
     [True,  True,  True,  True,  True],
     [True,  False, False, False, True],
     [True,  False, False, False, True] ],
   [ [True,  True,  True,  True,  False],  # { B }
     [True,  False, False, False, True],
     [True,  True,  True,  True,  False],
     [True,  False, False, False, True],
     [True,  True,  True,  True,  False] ],
   [ [False, True,  True,  True,  True],   # { C }
     [True,  False, False, False, False],
     [True,  False, False, False, False],
     [True,  False, False, False, False],
     [False, True,  True,  True,  True] ],
   [ [True,  True,  True,  True,  False],  # { D }
     [True,  False, False, False, True],
     [True,  False, False, False, True],
     [True,  False, False, False, True],
     [True,  True,  True,  True,  False] ],
   [ [True,  True,  True,  True,  True],   # { E }
     [True,  False, False, False, False],
     [True,  True,  True,  False, False],
     [True,  False, False, False, False],
     [True,  True,  True,  True,  True] ],
   [ [True,  True,  True,  True,  True],   # { F }
     [True,  False, False, False, False],
     [True,  True,  True,  False, False],
     [True,  False, False, False, False],
     [True,  False, False, False, False] ],
   [ [True,  True,  True,  True,  True],   # { G }
     [True,  False, False, False, False],
     [True,  False, False, False, False],
     [True,  False, False, False, True],
     [True,  True,  True,  True,  True] ],
   [ [True,  False, False, False, True],   # { H }
     [True,  False, False, False, True],
     [True,  True,  True,  True,  True],
     [True,  False, False, False, True],
     [True,  False, False, False, True] ],
   [ [False, False, True,  False, False],  # { I }
     [False, False, True,  False, False],
     [False, False, True,  False, False],
     [False, False, True,  False, False],
     [False, False, True,  False, False] ],
   [ [False, False, True,  True,  True],   # { J }
     [False, False, False, True,  False],
     [False, False, False, True,  False],
     [False, False, False, True,  False],
     [True,  True,  True,  True,  False] ],
   [ [True,  False, False, False, True],   # { K }
     [True,  False, False, True,  False],
     [True,  True,  True,  False, False],
     [True,  False, False, True,  False],
     [True,  False, False, False, True] ],
   [ [True,  False, False, False, False],  # { L }
     [True,  False, False, False, False],
     [True,  False, False, False, False],
     [True,  False, False, False, False],
     [True,  True,  True,  True,  True] ],
   [ [True,  True,  False, True,  True],   # { N }
     [True,  False, True,  False, True],
     [True,  False, False, False, True],
     [True,  False, False, False, True],
     [True,  False, False, False, True] ],
   [ [True,  False, False, False, True],   # { M }
     [True,  True,  False, False, True],
     [True,  False, True,  False, True],
     [True,  False, False, True,  True],
     [True,  False, False, False, True] ],
   [ [False, True,  True,  True,  False],  # { O }
     [True,  False, False, False, True],
     [True,  False, False, False, True],
     [True,  False, False, False, True],
     [False, True,  True,  True,  False] ],
   [ [True,  True,  True,  True,  False],  # { P }
     [True,  False, False, False, True],
     [True,  True,  True,  True,  False],
     [True,  False, False, False, False],
     [True,  False, False, False, False] ],
   [ [True,  True,  True,  True,  True],   # { Q }
     [True,  False, False, False, True],
     [True,  False, False, False, True],
     [True,  False, False, True,  True],
     [True,  True,  True,  True,  True] ],
   [ [True,  True,  True,  True,  False],  # { R }
     [True,  False, False, False, True],
     [True,  True,  True,  True,  False],
     [True,  False, False, True,  False],
     [True,  False, False, False, True] ],
   [ [False, True,  True,  True,  True],   # { S }
     [True,  False, False, False, False],
     [False, True,  True,  True,  False],
     [False, False, False, False, True],
     [True,  True,  True,  True,  False] ],
   [ [True,  True,  True,  True,  True],   # { T }
     [False, False, True,  False, False],
     [False, False, True,  False, False],
     [False, False, True,  False, False],
     [False, False, True,  False, False] ],
   [ [True,  False, False, False, True],   # { U }
     [True,  False, False, False, True],
     [True,  False, False, False, True],
     [True,  False, False, False, True],
     [False, True,  True,  True,  False] ],
   [ [True,  False, False, False, True],   # { V }
     [True,  False, False, False, True],
     [True,  False, False, False, True],
     [False, True,  False, True,  False],
     [False, False, True,  False, False] ],
   [ [True,  False, False, False, True],   # { W }
     [True,  False, False, False, True],
     [True,  False, False, False, True],
     [True,  False, True,  False, True],
     [False, True,  False, True,  False] ],
   [ [True,  False, False, False, True],   # { X }
     [False, True,  False, True,  False],
     [False, False, True,  False, False],
     [False, True,  False, True,  False],
     [True,  False, False, False, True] ],
   [ [True,  False, False, False, True],   # { Y }
     [False, True,  False, True,  False],
     [False, False, True,  False, False],
     [False, False, True,  False, False],
     [False, False, True,  False, False] ],
   [ [True,  True,  True,  True,  True],   # { Z }
     [False, False, False, True,  False],
     [False, False, True,  False, False],
     [False, True,  False, False, False],
     [True,  True,  True,  True,  True] ]]


exemple_a_reconnaitre = [ [True,  False, True,  False, True],
                          [True,  True,  False, False, True],
                          [False, False, True,  False, True],
                          [True,  False, False, True,  True],
                          [True, False, False, False, True] ]

def print_forme(forme):
    for ligne in range(5):
        for colonne in range(5):
            if(forme[ligne][colonne] == True):
                print('#', end='')
            else:
                print(' ', end='')
        print("\n", end='')
        
def m_to_l(matrix):
    result = []
    for i in range(5):
        for j in range(5):
            result.append(matrix[i][j])
            
    return result

def l_to_m(liste):
    result = []        
    for i in range(5):
        part = []
        for j in range(5):
            part.append(liste[5*i+j])
        result.append(part)    
    return result

alphab = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"

index = {}
ind = 0
for l in alphab:
    index[l] = ind
    ind += 1
    
def message(text):
    assemble = [[] for i in range(5)]
    
    for l in text.upper():
        forme = alphabet[index[l]]
        for ligne in range(5):
            assemble[ligne] = assemble[ligne] + forme[ligne] + [False]        
            
    for ligne in range(5):
        for lettre in assemble[ligne]:                    
            if(lettre == True):
                 print('#', end=' ')

            else:
                print(' ', end=' ')
            
        print("")

def iteration(etat, poids, seuils):
    R = N_cell  
    for cellule in range(R):  
        somme = 0       
        for voisine in range(R):
            if(cellule != voisine):                   
                somme += poids[cellule][voisine] * etat[voisine]
                
        suivante = somme - seuils[cellule]   
       
        suivante = True if suivante > 0 else False 
        
        etat[cellule] = suivante
    return etat

def train(etat, forme, poids, seuils, eps):  
    R = N_cell
    
    for cellule in range(R):  
        somme = 0
        nb_participant = 0
        for voisine in range(R):
            if(cellule != voisine):
                if(etat[voisine] == True):
                    somme += poids[cellule][voisine]
                    nb_participant += 1          
        suivante = somme - seuils[cellule]           
        suivante = True if suivante > 0 else False   
        
        if(suivante != forme[cellule]):                  
            erreur = forme[cellule] - suivante          
            delta = (erreur + eps) / nb_participant
          
            for voisine in range(N_cell):
                 if(cellule != voisine):
                    if(etat[voisine] == True):                       
                        poids[cellule][voisine] += delta
                        poids[voisine][cellule] += delta
            
            seuils[cellule] -= delta                      
    return poids, seuils

lettre_debut = "A"
lettre_fin = "C"

mini = index[lettre_debut]
maxi = index[lettre_fin]

N = 5 # nombre de lignes (et de colonnes) d'une forme

N_cell = N*N

# états des cellules du réseau (booléens)
etats = [ False for _ in range(N_cell) ]

# seuils des cellules du réseau (réels)
seuils = [ 0 for _ in range(N_cell) ]

# poids des connexions du réseau (réels)
poids = [ [ 0.5 for _ in range(N_cell)] for _ in range(N_cell) ]

epsilon = 0.2 # La marge de sécurité   

message("BONJOUR")
print("\nOn entraine des Lettres {} à {}".format(lettre_debut, lettre_fin))
for lettre in range(mini, maxi + 1):  
    for i in range(10): # Après 10, les poids et seuils ne changent plus
        poids, seuils = train(m_to_l(alphabet[lettre]), m_to_l(alphabet[lettre]), poids, seuils, epsilon)   
 
it = 10
for letter in range(mini, maxi+ 1):                                
    forme = alphabet[letter]   
    print("Entrée :\n")
    print_forme(forme)    
    etat_apres = m_to_l(forme)                                    

    for i in range(it):
        etat_apres = iteration(etat_apres, poids, seuils)
    print("Sortie :\n")
    print_forme(l_to_m(etat_apres))
    print("\n")


lettre_debut = "M"
lettre_fin = "N"

mini = index[lettre_debut]
maxi = index[lettre_fin]

# états des cellules du réseau (booléens)
etats = [ False for _ in range(N_cell) ]

# seuils des cellules du réseau (réels)
seuils = [ 0 for _ in range(N_cell) ]

# poids des connexions du réseau (réels)
poids = [ [ 0.5 for _ in range(N_cell)] for _ in range(N_cell) ]

epsilon = 0.2 # La marge de sécurité   

print("On entraine des Lettres {} à {} (pour la démonstration)".format(lettre_debut, lettre_fin))

for lettre in range(mini, maxi + 1):  
    for i in range(10): # Après 10, les poids et seuils ne changent plus
        poids, seuils = train(m_to_l(alphabet[lettre]), m_to_l(alphabet[lettre]), poids, seuils, epsilon)   


# La forme à reconnaître
it = 10
forme = exemple_a_reconnaitre
print("Entrée :\n")
print_forme(forme)
etats = m_to_l(forme)
print("\n")
for i in range(it):
    etats = iteration(etats, poids, seuils)
print("Sortie :\n")
print_forme(l_to_m(etats))

